<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Register Member - Jameya Admin</title>
    <link rel="stylesheet" href="../../assets/vendors/feather/feather.css">
    <link rel="stylesheet" href="../../assets/vendors/ti-icons/css/themify-icons.css">
    <link rel="stylesheet" href="../../assets/vendors/css/vendor.bundle.base.css">
    <link rel="stylesheet" href="../../assets/vendors/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../assets/vendors/mdi/css/materialdesignicons.min.css">
    <link rel="stylesheet" href="../../assets/css/style.css">
    <link rel="stylesheet" href="../../assets/css/i18n.css">
    <link rel="icon" href="data:,">
  </head>
  <body>
    <div class="container-scroller">
      <!-- partial:partials/_navbar.html -->
      <nav class="navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
        <div class="text-center navbar-brand-wrapper d-flex align-items-center justify-content-lg-center justify-content-start">
          <a class="navbar-brand brand-logo text-white" href="index.html">
            Jameya
          </a>
          <a class="navbar-brand brand-logo-mini text-white" href="index.html">
            
            Jameya
          </a>
        </div>
        <div class="navbar-menu-wrapper d-flex align-items-center justify-content-end">
          <button class="navbar-toggler navbar-toggler align-self-center text-white" type="button" data-toggle="minimize">
            <span class="icon-menu"></span>
          </button>
          
          <ul class="navbar-nav navbar-nav-right">
            <li class="nav-item dropdown">
              <a class="nav-link count-indicator dropdown-toggle" id="notificationDropdown" href="#" data-bs-toggle="dropdown">
                <i class="icon-bell mx-0"></i>
                <span class="count"></span>
              </a>
              <div class="dropdown-menu dropdown-menu-right navbar-dropdown preview-list" aria-labelledby="notificationDropdown">
                <p class="mb-0 font-weight-normal float-left dropdown-header" data-i18n="navbar.notifications">Notifications</p>
                <a class="dropdown-item preview-item">
                  <div class="preview-thumbnail">
                    <div class="preview-icon bg-success">
                      <i class="ti-info-alt mx-0"></i>
                    </div>
                  </div>
                  <div class="preview-item-content">
                    <h6 class="preview-subject font-weight-normal" data-i18n="navbar.applicationError">Application Error</h6>
                    <p class="font-weight-light small-text mb-0 text-muted" data-i18n="navbar.justNow"> Just now </p>
                  </div>
                </a>
                <a class="dropdown-item preview-item">
                  <div class="preview-thumbnail">
                    <div class="preview-icon bg-warning">
                      <i class="ti-settings mx-0"></i>
                    </div>
                  </div>
                  <div class="preview-item-content">
                    <h6 class="preview-subject font-weight-normal" data-i18n="navbar.settings">Settings</h6>
                    <p class="font-weight-light small-text mb-0 text-muted" data-i18n="navbar.privateMessage"> Private message </p>
                  </div>
                </a>
                <a class="dropdown-item preview-item">
                  <div class="preview-thumbnail">
                    <div class="preview-icon bg-info">
                      <i class="ti-user mx-0"></i>
                    </div>
                  </div>
                  <div class="preview-item-content">
                    <h6 class="preview-subject font-weight-normal" data-i18n="navbar.newUserRegistration">New user registration</h6>
                    <p class="font-weight-light small-text mb-0 text-muted"> 2 <span data-i18n="navbar.daysAgo">days ago</span> </p>
                  </div>
                </a>
              </div>
            </li>
            <li class="nav-item nav-profile dropdown">
              <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown" id="profileDropdown">
                <img src="assets/images/faces/face28.webp" alt="profile" />
              </a>
              <div class="dropdown-menu dropdown-menu-right navbar-dropdown" aria-labelledby="profileDropdown">
                <a class="dropdown-item">
                  <i class="ti-settings text-primary"></i> <span data-i18n="navbar.settings">Settings</span> </a>
                <a class="dropdown-item">
                  <i class="ti-power-off text-primary"></i> <span data-i18n="navbar.logout">Logout</span> </a>
              </div>
            </li>
            <li class="nav-item nav-settings d-none d-lg-flex">
              <a class="nav-link" href="#">
                <i class="icon-ellipsis"></i>
              </a>
            </li>
          </ul>
          <button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center text-white" type="button" data-toggle="offcanvas">
            <span class="icon-menu"></span>
          </button>
        </div>
      </nav>

      <div class="container-fluid page-body-wrapper">
         <!-- partial:partials/_sidebar.html -->
         <nav class="sidebar sidebar-offcanvas" id="sidebar">
            <ul class="nav">
              <li class="nav-item">
                <a class="nav-link" href="../../index.html">
                  <i class="icon-grid menu-icon"></i>
                  <span class="menu-title" data-i18n="sidebar.dashboard">Dashboard</span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="../../pages/payments/monthly-payment.html">
                  <i class="ti-save bi bi-wallet menu-icon"></i>
                  <!-- <i class="bi bi-wallet"></i> -->
                  <span class="menu-title" data-i18n="sidebar.monthlyPayment">Monthly Payment</span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="../../pages/payments/payment-received.html">
                  <i class="ti-receipt bi bi-wallet menu-icon"></i>
                  <!-- <i class="bi bi-wallet"></i> -->
                  <span class="menu-title" data-i18n="sidebar.paymentReceived">Payment Received</span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="../../pages/members/member-register.html">
                  <i class="ti-calendar bi bi-wallet menu-icon"></i>
                  
                  <span class="menu-title" data-i18n="sidebar.memberRegister">Member Register</span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="../../pages/members/member-list.html">
                  <i class="ti-calendar bi bi-wallet menu-icon"></i>
                  
                  <span class="menu-title" data-i18n="sidebar.membersList">Members List</span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="../../pages/members/members-schedule.html">
                  <i class="ti-calendar bi bi-wallet menu-icon"></i>
                  <!-- <i class="bi bi-wallet"></i> -->
                  <span class="menu-title" data-i18n="sidebar.membersSchedule">Members Schedule</span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" data-bs-toggle="collapse" href="#language" aria-expanded="false" aria-controls="language">
                  <i class="icon-head menu-icon"></i>
                  <span class="menu-title" data-i18n="sidebar.language">Language</span>
                  <i class="menu-arrow"></i>
                </a>
                <div class="collapse" id="language">
                  <ul class="nav flex-column sub-menu">
                    <li class="nav-item"> <a class="nav-link" href="#" data-lang="ar"> <span data-i18n="sidebar.arabic">Arabic</span> </a></li>
                    <li class="nav-item"> <a class="nav-link" href="#" data-lang="en"> <span data-i18n="sidebar.english">English</span> </a></li>
                  </ul>
                </div>
              </li>
              <li class="nav-item">
                <a class="nav-link" data-bs-toggle="collapse" href="#auth" aria-expanded="false" aria-controls="auth">
                  <i class="icon-head menu-icon"></i>
                  <span class="menu-title" data-i18n="sidebar.userPages">User Pages</span>
                  <i class="menu-arrow"></i>
                </a>
                <div class="collapse" id="auth">
                  <ul class="nav flex-column sub-menu">
                    <li class="nav-item"> <a class="nav-link" href="../../pages/samples/login.html"> <span data-i18n="sidebar.login">Login</span> </a></li>
                    <li class="nav-item"> <a class="nav-link" href="../../pages/samples/signup.html"> <span data-i18n="sidebar.signUp">Sign Up</span> </a></li>
                  </ul>
                </div>
              </li>
              
            </ul>
          </nav>

        <!-- partial -->
        <div class="main-panel">
          <div class="content-wrapper">
          </div>
          <!-- content-wrapper ends -->
          <!-- partial:../../partials/_footer.html -->
          <footer class="footer">
            <div class="text-center">
              <span class="text-muted text-center text-primary" data-i18n="footer.copyright">Copyright Â© 2025 OpticoreAI.com</span>
              
            </div>
          </footer>
          <!-- partial -->
        </div>
      </div>
    </div>

    <script src="../../assets/vendors/js/vendor.bundle.base.js"></script>
    <script src="../../assets/js/off-canvas.js"></script>
    <script src="../../assets/js/template.js"></script>
    <script src="../../assets/js/data/storage.js"></script>
    <script src="../../assets/js/data/members.js"></script>
    <script src="../../assets/js/utils/helpers.js"></script>
    <script src="../../assets/js/auth.js"></script>
    <script src="../../assets/js/app.js"></script>
    <script src="../../assets/js/jquery.cookie.js" type="text/javascript"></script>
    <script src="../../assets/js/i18n.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Check authentication
        if (!AuthManager.requireAuth()) return;

        const memberId = Helpers.getUrlParameter('id');
        let isEditMode = false;

        // Load member data if editing
        if (memberId) {
          isEditMode = true;
          document.getElementById('pageTitle').textContent = 'Edit Member';
          loadMemberData(memberId);
        }

        // Form submission
        document.getElementById('memberForm').addEventListener('submit', function(e) {
          e.preventDefault();
          saveMember();
        });

        function loadMemberData(id) {
          try {
            const member = MembersManager.getById(id);
            if (!member) {
              Helpers.showError('Member not found');
              window.location.href = 'member-list.html';
              return;
            }

            document.getElementById('memberName').value = member.name;
            document.getElementById('phoneNumber').value = member.phoneNumber;
            document.getElementById('nationalId').value = member.nationalId || '';
            document.getElementById('email').value = member.email || '';
            document.getElementById('status').value = member.status;
          } catch (error) {
            Helpers.showError('Error loading member: ' + error.message);
          }
        }

        function saveMember() {
          const formData = {
            name: document.getElementById('memberName').value.trim(),
            phoneNumber: document.getElementById('phoneNumber').value.trim(),
            nationalId: document.getElementById('nationalId').value.trim() || null,
            email: document.getElementById('email').value.trim() || null,
            status: document.getElementById('status').value
          };

          // Validation
          if (!formData.name) {
            Helpers.showError('Name is required');
            return;
          }

          if (!Helpers.validatePhone(formData.phoneNumber)) {
            Helpers.showError('Please enter a valid phone number');
            return;
          }

          if (formData.email && !Helpers.validateEmail(formData.email)) {
            Helpers.showError('Please enter a valid email address');
            return;
          }

          try {
            if (isEditMode) {
              MembersManager.update(memberId, formData);
              Helpers.showSuccess('Member updated successfully');
            } else {
              MembersManager.create(formData);
              Helpers.showSuccess('Member registered successfully');
            }
            
            setTimeout(() => {
              window.location.href = 'member-list.html';
            }, 1000);
          } catch (error) {
            Helpers.showError(error.message);
          }
        }
      });
    </script>
  </body>
</html>


